<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UTSG Major Resource Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#002A5C',
            secondary: '#E31837',
          },
          borderRadius: {
            button: '8px',
          },
        },
      },
    };
  </script>

  <!-- Remix Icon -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css"
    rel="stylesheet"
  />

  <!-- Leaflet CSS & JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body, html {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      scroll-behavior: smooth;
    }
    /* left logo height */
    .uoft-logo {
      height: 40px;
    }
    /* Modal */
    .modal-backdrop {
      background-color: rgba(0, 0, 0, 0.5);
    }
    /* Animation */
    @keyframes fade-in-down {
      0% { opacity: 0; transform: translateY(-10px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in-down {
      animation: fade-in-down 0.3s ease-out;
    }
    .rounded-button {
      border-radius: 8px;
    }
    /* Little Menu */
    .hidden {
      display: none !important;
    }
  </style>
  <!-- 新增：调整登录页面 Logo 的尺寸 -->
  <style>
    /* 使登录页面的 UofT logo 更小，保持设计平衡 */
    #signInModal img {
      width: 50px !important;
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen">

  <!-- ===================== Navi ===================== -->
  <nav class="bg-white/80 backdrop-blur-md text-primary border-b border-gray-100 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <!-- Left：UofT Logo & Navi -->
        <div class="flex items-center space-x-8">
          <!-- UofT logo -->
          <img src="uoft_logo.png" alt="University of Toronto Logo" class="uoft-logo" />
          <!-- left hidden md:flex -->
          <div class="flex space-x-6">
            <button class="text-sm font-medium hover:text-secondary transition-colors flex items-center" onclick="navigateToPage('home')">
              <i class="ri-home-line mr-1"></i> Home
            </button>
            <button class="text-sm font-medium hover:text-secondary transition-colors" onclick="navigateToPage('about')">
              About
            </button>
            <button class="text-sm font-medium hover:text-secondary transition-colors" onclick="navigateToPage('reservations')">
              My Reservations
            </button>
            <!-- New Campus Life nav button -->
            <button class="text-sm font-medium hover:text-secondary transition-colors" onclick="goToCampusLife()">
              Campus Life
            </button>
          </div>
        </div>

        <!-- Sign In and show Karen + menu -->
        <div class="flex items-center space-x-4">
          <button
            id="signInButton"
            onclick="showSignInModal()"
            class="px-3 py-2 text-sm font-medium hover:text-secondary transition-colors"
          >
            Sign In
          </button>

          <!-- After log in -->
          <div id="userMenuContainer" class="relative hidden">
            <button
              onclick="toggleUserMenu()"
              class="px-3 py-2 text-sm font-medium hover:text-secondary transition-colors flex items-center"
            >
              <span id="userNameLabel">Karen</span>
              <i class="ri-arrow-down-s-line ml-1"></i>
            </button>
            <div
              id="userDropdown"
              class="hidden absolute right-0 mt-2 w-32 bg-white border border-gray-100 rounded-lg shadow-lg"
            >
              <button
                onclick="showSettings()"
                class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-50"
              >
                Settings
              </button>
              <button
                onclick="logOut()"
                class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-50 text-red-600"
              >
                Log Out
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- ===================== HOME PAGE ===================== -->
  <div id="homePage" class="relative min-h-screen bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-primary/5 via-white to-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-16 pb-24">
      <div class="text-center mb-16">
        <h1 class="text-5xl font-bold text-primary mb-6">UTSG Major Resource Map</h1>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">
          Discover comprehensive resources and facilities tailored to your academic journey at the University of Toronto St. George Campus
        </p>
      </div>
      <!-- Major card grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
        <!-- (Existing major cards remain unchanged) -->
        <!-- 1. Computer Science -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToMap('Computer Science')" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-code-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">Computer Science</h3>
            </div>
            <p class="text-gray-600 text-sm">Labs & communities</p>
          </button>
        </div>
        <!-- 2. Engineering -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToMap('Engineering')" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-tools-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">Engineering</h3>
            </div>
            <p class="text-gray-600 text-sm">Labs & design studios</p>
          </button>
        </div>
        <!-- 3. Rotman Commerce -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToMap('Rotman Commerce')" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-bank-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">Rotman Commerce</h3>
            </div>
            <p class="text-gray-600 text-sm">Business & networking</p>
          </button>
        </div>
        <!-- 4. Arts & Humanities -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToMap('Arts & Humanities')" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-book-open-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">Arts & Humanities</h3>
            </div>
            <p class="text-gray-600 text-sm">Libraries & cultural spaces</p>
          </button>
        </div>
        <!-- 5. Social Sciences -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToMap('Social Sciences')" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-group-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">Social Sciences</h3>
            </div>
            <p class="text-gray-600 text-sm">Policy & community</p>
          </button>
        </div>
        <!-- 6. Biological Sciences -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToMap('Biological Sciences')" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-microscope-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">Biological Sciences</h3>
            </div>
            <p class="text-gray-600 text-sm">Labs & research</p>
          </button>
        </div>
        <!-- 7. Physical Sciences -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToMap('Physical Sciences')" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-flask-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">Physical Sciences</h3>
            </div>
            <p class="text-gray-600 text-sm">Labs & equipment</p>
          </button>
        </div>
        <!-- 8. Health Sciences -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToMap('Health Sciences')" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-heart-pulse-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">Health Sciences</h3>
            </div>
            <p class="text-gray-600 text-sm">Clinics & support</p>
          </button>
        </div>
        <!-- 9. Law -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToMap('Law')" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-scales-3-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">Law</h3>
            </div>
            <p class="text-gray-600 text-sm">Legal & moot courts</p>
          </button>
        </div>
        <!-- 10. Education -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToMap('Education')" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-graduation-cap-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">Education</h3>
            </div>
            <p class="text-gray-600 text-sm">Teaching & learning</p>
          </button>
        </div>
        <!-- 11. Architecture Design -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToMap('Architecture Design')" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-building-2-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">Architecture Design</h3>
            </div>
            <p class="text-gray-600 text-sm">Design & workshops</p>
          </button>
        </div>
        <!-- 12. Music -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToMap('Music')" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-music-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">Music</h3>
            </div>
            <p class="text-gray-600 text-sm">Practice & performance</p>
          </button>
        </div>
        <!-- 13. Information -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToMap('Information')" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-database-2-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">Information</h3>
            </div>
            <p class="text-gray-600 text-sm">Resources & tech labs</p>
          </button>
        </div>
        <!-- 14. Kinesiology & Physical -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToMap('Kinesiology & Physical')" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-run-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">Kinesiology & Physical</h3>
            </div>
            <p class="text-gray-600 text-sm">Sports & research</p>
          </button>
        </div>
        <!-- 15. International Studies -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToMap('International Studies')" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-global-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">International Studies</h3>
            </div>
            <p class="text-gray-600 text-sm">Global & study spaces</p>
          </button>
        </div>
        <!-- New: Campus Life Card -->
        <div class="group hover:scale-105 transition-transform duration-300">
          <button onclick="goToCampusLife()" class="w-full bg-white/70 backdrop-blur-sm shadow-lg hover:shadow-xl rounded-xl p-6 text-left border border-gray-100 hover:border-primary/20 hover:bg-white">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg flex items-center justify-center">
                <i class="ri-rocket-line text-primary text-2xl"></i>
              </div>
              <h3 class="text-xl font-semibold ml-4 text-gray-900">Campus Life</h3>
            </div>
            <p class="text-gray-600 text-sm">Explore clubs, events & campus resources.</p>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===================== MAP PAGE ===================== -->
  <div id="mapView" class="hidden">
    <div class="flex h-[calc(100vh-4rem)]">
      <!-- Map -->
      <div class="w-[70%] relative">
        <div id="map" class="h-full"></div>
        <button onclick="returnToHome()" class="absolute top-4 right-4 bg-white px-4 py-2 rounded-button shadow-lg hover:bg-gray-50 flex items-center space-x-2 z-[1000]">
          <i class="ri-home-line"></i><span>Return to Home</span>
        </button>
      </div>
      <!-- Right list -->
      <div class="w-[30%] bg-white shadow-lg overflow-y-auto p-6">
        <div class="relative mb-6">
          <input type="text" placeholder="Search resources..." class="w-full pl-10 pr-4 py-3 border-none bg-gray-50 rounded-xl text-sm focus:ring-2 focus:ring-primary/20 focus:outline-none" />
          <i class="ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
        <div id="categoryList" class="space-y-8">
          <!-- JS Resources -->
        </div>
      </div>
    </div>
  </div>

  <!-- ===================== MY RESERVATIONS PAGE ===================== -->
  <div id="reservationsPage" class="hidden min-h-screen bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="flex space-x-8">
        <!-- Left: My Schedule -->
        <div class="w-2/3">
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-2xl font-bold text-gray-900">My Schedule</h2>
              <div class="flex space-x-4">
                <button onclick="showCalendarView()" class="px-4 py-2 text-sm bg-gray-100 text-gray-700 rounded-button hover:bg-gray-200">
                  <i class="ri-calendar-line mr-2"></i>Calendar View
                </button>
                <button onclick="makeNewReservation()" class="px-4 py-2 text-sm bg-primary text-white rounded-button hover:bg-primary/90">
                  <i class="ri-add-line mr-2"></i>New Reservation
                </button>
              </div>
            </div>
            <div class="flex space-x-4 border-b border-gray-100 mb-4">
              <button class="px-4 py-2 text-sm font-medium text-primary border-b-2 border-primary">Upcoming</button>
              <button class="px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-700">Past</button>
              <button class="px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-700">All</button>
            </div>
            <div id="reservationList" class="space-y-4">
              <!-- Reservations -->
            </div>
          </div>

          <!-- NEW: My Campus Life Applications (Separate Section) -->
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">My Campus Life Applications</h2>
            <div id="campusLifeSubmissionList" class="space-y-4">
              <!-- Will show user-submitted events with Contact, Cancel buttons, and a Reserved pill -->
            </div>
          </div>
        </div>
        <!-- Quick Stats -->
        <div class="w-1/3 space-y-6">
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <h3 class="text-lg font-bold text-gray-900 mb-4">Recommended for Bachelor of Information</h3>
            <div id="recommendedResources" class="space-y-4">
              <!-- Recommend Resources -->
            </div>
          </div>
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <h3 class="text-lg font-bold text-gray-900 mb-4">Quick Stats</h3>
            <div class="grid grid-cols-2 gap-4">
              <div class="p-4 bg-gray-50 rounded-xl text-center">
                <p id="statUpcoming" class="text-2xl font-bold text-primary mb-2">0</p>
                <p class="text-sm text-gray-600">Upcoming</p>
              </div>
              <div class="p-4 bg-gray-50 rounded-xl text-center">
                <p class="text-2xl font-bold text-primary mb-2">0</p>
                <p class="text-sm text-gray-600">Past</p>
              </div>
              <div class="p-4 bg-gray-50 rounded-xl text-center">
                <p class="text-2xl font-bold text-primary mb-2">0</p>
                <p class="text-sm text-gray-600">Favorites</p>
              </div>
              <div class="p-4 bg-gray-50 rounded-xl text-center">
                <p class="text-2xl font-bold text-primary mb-2">0%</p>
                <p class="text-sm text-gray-600">Usage</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===================== ABOUT PAGE ===================== -->
  <div id="aboutPage" class="hidden min-h-screen bg-white py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h1 class="text-4xl font-bold text-primary mb-4">About University of Toronto</h1>
        <p class="text-xl text-gray-600">Discover our rich history and commitment to excellence</p>
      </div>
      <div class="prose prose-lg max-w-4xl mx-auto">
        <div class="mb-12">
          <h2 class="text-2xl font-bold text-gray-900 mb-4">Our History</h2>
          <p class="text-gray-600">
            Founded in 1827, the University of Toronto is Canada's leading institution of learning, discovery and knowledge creation. We are proud to be one of the world's top research-intensive universities, driven to invent and innovate.
          </p>
        </div>
        <div class="mb-12">
          <h2 class="text-2xl font-bold text-gray-900 mb-4">Our Mission</h2>
          <p class="text-gray-600">
            The University of Toronto is dedicated to fostering an academic community in which the learning and scholarship of every member may flourish, with vigilant protection for individual human rights, and a resolute commitment to the principles of equal opportunity, equity and justice.
          </p>
        </div>
        <div class="mb-12">
          <h2 class="text-2xl font-bold text-gray-900 mb-4">Key Facts</h2>
          <ul class="list-disc pl-4 text-gray-600 space-y-2">
            <li><strong>93,000+</strong> Students across three campuses</li>
            <li><strong>980+</strong> Programs of study</li>
            <li><strong>Top 20</strong> Global university ranking</li>
            <li><strong>600,000+</strong> Alumni worldwide</li>
          </ul>
        </div>
        <div class="mb-12">
          <h2 class="text-2xl font-bold text-gray-900 mb-4">About This Project</h2>
          <p class="text-gray-600 mb-4">
            This resource map was created by <span class="font-semibold">Tianen Hao</span> as part of the INF481 Final Project. The goal of this project is to help students easily locate and access various resources available across the University of Toronto St. George campus.
          </p>
          <p class="text-gray-600">
            The interactive map provides real-time information about study spaces, research facilities, and other academic resources, making it easier for students to find and reserve the spaces they need.
          </p>
        </div>
        <div class="text-center mt-12">
          <button onclick="returnToHome()" class="px-6 py-3 bg-primary text-white rounded-button hover:bg-primary/90 inline-flex items-center">
            <i class="ri-arrow-left-line mr-2"></i>Return to Home
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===================== CAMPUS LIFE PAGE ===================== -->
  <div id="campusLifePage" class="hidden min-h-screen bg-white py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h1 class="text-4xl font-bold text-primary mb-4">Campus Life at U of T</h1>
        <p class="text-xl text-gray-600">Discover clubs, events, and services that shape the vibrant campus experience.</p>
      </div>
      <!-- Search and Recommendation Section -->
      <div class="mb-12">
        <input id="campusLifeSearch" type="text" placeholder="Search campus life..." class="w-full p-3 border border-gray-200 rounded-xl" />
      </div>
      <div id="campusLifeList" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Campus Life items will be dynamically loaded here -->
      </div>
    </div>
  </div>

  <!-- ===================== CAMPUS LIFE MODAL ===================== -->
  <div id="campusLifeModal" class="hidden fixed inset-0 flex items-center justify-center z-[4000] modal-backdrop">
    <div class="bg-white rounded-xl max-w-md w-full mx-4 p-6 animate-fade-in-down relative">
      <!-- The "Close" button below remains in code but will be forcibly removed. -->
      <button class="absolute top-3 right-3 text-gray-400 hover:text-gray-500" onclick="closeCampusLifeModal()">
        <i class="ri-close-line ri-2x"></i>
      </button>
      <div id="campusLifeModalContent" class="space-y-6">
        <!-- Campus Life basic details will be injected here -->
      </div>
    </div>
  </div>

  <!-- ===================== CAMPUS LIFE EVENTS MODAL ===================== -->
  <div id="campusLifeEventsModal" class="hidden fixed inset-0 flex items-center justify-center z-[4500] modal-backdrop">
    <div class="bg-white rounded-xl max-w-5xl w-full mx-4 p-6 animate-fade-in-down relative">
      <button class="absolute top-3 right-3 text-gray-400 hover:text-gray-500" onclick="closeCampusLifeEventsModal()">
        <i class="ri-close-line ri-2x"></i>
      </button>
      <!-- We'll use a grid of 3 columns for the events. -->
      <div id="campusLifeEventsModalContent" class="grid grid-cols-3 gap-4">
        <!-- List of events (3 columns) will be injected here -->
      </div>
    </div>
  </div>

  <!-- ===================== CAMPUS LIFE EVENT DETAIL MODAL ===================== -->
  <div id="campusLifeEventDetailModal" class="hidden fixed inset-0 flex items-center justify-center z-[5000] modal-backdrop">
    <div class="bg-white rounded-xl max-w-md w-full mx-4 p-6 animate-fade-in-down relative">
      <button class="absolute top-3 right-3 text-gray-400 hover:text-gray-500" onclick="closeCampusLifeEventDetailModal()">
        <i class="ri-close-line ri-2x"></i>
      </button>
      <div id="campusLifeEventDetailModalContent" class="space-y-6">
        <!-- Event details will be injected here -->
      </div>
    </div>
  </div>

  <!-- ===================== SIGN IN MODAL ===================== -->
  <div id="signInModal" class="hidden fixed inset-0 flex items-center justify-center z-[9999] modal-backdrop">
    <div class="bg-white rounded-xl max-w-sm w-full mx-4 p-6 animate-fade-in-down relative">
      <button class="absolute top-3 right-3 text-gray-400 hover:text-gray-500" onclick="closeSignInModal()">
        <i class="ri-close-line ri-2x"></i>
      </button>
      <div class="text-center mb-6">
        <img src="uoft_logo.png" alt="UofT Logo" class="w-15 h-auto mx-auto mb-4" />
        <h3 class="text-xl font-bold text-gray-900">Sign in with UTORid</h3>
        <p class="text-sm text-gray-600 mt-2">Access UofT resources and services</p>
      </div>
      <form onsubmit="handleSignIn(event)" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">UTORid</label>
          <input type="text" required placeholder="Enter your UTORid" class="w-full px-4 py-2 border border-gray-200 rounded-button text-sm" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
          <input type="password" required placeholder="Enter your password" class="w-full px-4 py-2 border border-gray-200 rounded-button text-sm" />
        </div>
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <input type="checkbox" id="rememberMe" class="h-4 w-4 text-primary rounded" />
            <label for="rememberMe" class="ml-2 text-sm text-gray-600">Remember me</label>
          </div>
          <a href="#" class="text-sm text-primary hover:text-primary/90">Forgot password?</a>
        </div>
        <button type="submit" class="w-full px-4 py-2 bg-primary text-white rounded-button hover:bg-primary/90 flex items-center justify-center">
          <i class="ri-login-box-line mr-2"></i>Sign in with UTORid
        </button>
      </form>
    </div>
  </div>

  <!-- ===================== Pop-up window (Resource Modal) ===================== -->
  <div id="resourceModal" class="hidden fixed inset-0 flex items-center justify-center z-[2000] modal-backdrop">
    <div class="bg-white rounded-xl max-w-md w-full mx-4 p-6 animate-fade-in-down relative">
      <button class="absolute top-3 right-3 text-gray-400 hover:text-gray-500" onclick="closeResourceModal()">
        <i class="ri-close-line ri-2x"></i>
      </button>
      <div id="modalContent" class="space-y-6">
        <!-- Contact info and resource details -->
      </div>
    </div>
  </div>

  <!-- ===================== Provider Details MODAL ===================== -->
  <div id="providerModal" class="hidden fixed inset-0 flex items-center justify-center z-[3000] modal-backdrop">
    <div class="bg-white rounded-xl max-w-md w-full mx-4 p-6 animate-fade-in-down relative">
      <button class="absolute top-3 right-3 text-gray-400 hover:text-gray-500" onclick="closeProviderModal()">
        <i class="ri-close-line ri-2x"></i>
      </button>
      <div id="providerModalContent" class="space-y-6">
        <!-- Provider details content will be injected here -->
      </div>
    </div>
  </div>

  <!-- ===================== JS Scripts ===================== -->
  <script>
    // Full page use
    const homePage = document.getElementById('homePage');
    const mapView = document.getElementById('mapView');
    const aboutPage = document.getElementById('aboutPage');
    const reservationsPage = document.getElementById('reservationsPage');
    const campusLifePage = document.getElementById('campusLifePage');
    const signInModal = document.getElementById('signInModal');
    const resourceModal = document.getElementById('resourceModal');
    const modalContent = document.getElementById('modalContent');
    const providerModal = document.getElementById('providerModal');

    // Campus Life Modals
    const campusLifeModal = document.getElementById('campusLifeModal');
    const campusLifeModalContent = document.getElementById('campusLifeModalContent');
    const campusLifeEventsModal = document.getElementById('campusLifeEventsModal');
    const campusLifeEventsModalContent = document.getElementById('campusLifeEventsModalContent');
    const campusLifeEventDetailModal = document.getElementById('campusLifeEventDetailModal');
    const campusLifeEventDetailModalContent = document.getElementById('campusLifeEventDetailModalContent');

    // Right button
    const signInButton = document.getElementById('signInButton');
    const userMenuContainer = document.getElementById('userMenuContainer');
    const userDropdown = document.getElementById('userDropdown');
    const userNameLabel = document.getElementById('userNameLabel');

    let map = null;
    let currentMajor = '';
    let myReservations = [];
    let isLoggedIn = false; // Log in

    // =========== New: Additional array to store Campus Life Applications =============
    let myCampusLifeApplications = [];

    // ---------- Switch page ----------
    function navigateToPage(page) {
      homePage.classList.add('hidden');
      mapView.classList.add('hidden');
      aboutPage.classList.add('hidden');
      reservationsPage.classList.add('hidden');
      campusLifePage.classList.add('hidden');
      if (page === 'home') {
        homePage.classList.remove('hidden');
        window.scrollTo(0, 0);
      } else if (page === 'about') {
        aboutPage.classList.remove('hidden');
        window.scrollTo(0, 0);
      } else if (page === 'reservations') {
        reservationsPage.classList.remove('hidden');
        updateReservationList();
        updateCampusLifeSubmissionList(); // Also refresh the campus life apps
        window.scrollTo(0, 0);
      } else if (page === 'map') {
        mapView.classList.remove('hidden');
        window.scrollTo(0, 0);
      }
    }
    function returnToHome() {
      navigateToPage('home');
      if (map) {
        map.remove();
        map = null;
      }
    }

    // ---------- New: Campus Life Navigation Function ----------
    function goToCampusLife() {
      homePage.classList.add('hidden');
      mapView.classList.add('hidden');
      aboutPage.classList.add('hidden');
      reservationsPage.classList.add('hidden');
      campusLifePage.classList.remove('hidden');
      window.scrollTo(0, 0);
      loadCampusLifeItems();
    }

    // ---------- Log in/out ----------
    function showSignInModal() {
      signInModal.classList.remove('hidden');
    }
    function closeSignInModal() {
      signInModal.classList.add('hidden');
    }
    function handleSignIn(event) {
      event.preventDefault();
      isLoggedIn = true;
      alert('Signed in with UTORid successfully!');
      closeSignInModal();
      updateNav();
    }
    function updateNav() {
      if (isLoggedIn) {
        signInButton.classList.add('hidden');
        userMenuContainer.classList.remove('hidden');
      } else {
        signInButton.classList.remove('hidden');
        userMenuContainer.classList.add('hidden');
      }
    }
    function toggleUserMenu() {
      userDropdown.classList.toggle('hidden');
    }
    function showSettings() {
      alert('Settings page (demo).');
      userDropdown.classList.add('hidden');
    }
    function logOut() {
      isLoggedIn = false;
      alert('Logged out successfully!');
      updateNav();
    }

    // ---------- Simulated Resource Names (unchanged) ----------
    const simulatedResourceNames = {
      "Academic Facilities": function(major, index) {
         switch(major) {
            case "Computer Science":
              return "CS Innovation Lab " + (index+1);
            case "Engineering":
              return "Engineering Design Studio " + (index+1);
            case "Rotman Commerce":
              return "Rotman Business Center " + (index+1);
            case "Arts & Humanities":
              return "Arts Creative Space " + (index+1);
            case "Social Sciences":
              return "Social Research Library " + (index+1);
            case "Biological Sciences":
              return "Biological Research Lab " + (index+1);
            case "Physical Sciences":
              return "Physics Experiment Center " + (index+1);
            case "Health Sciences":
              return "Health Support Clinic " + (index+1);
            case "Law":
              return "Law Moot Court " + (index+1);
            case "Education":
              return "Teaching Resource Center " + (index+1);
            case "Architecture Design":
              return "Architectural Design Studio " + (index+1);
            case "Music":
              return "Music Practice Room " + (index+1);
            case "Information":
              return "Information Systems Lab " + (index+1);
            case "Kinesiology & Physical":
              return "Sports Performance Center " + (index+1);
            case "International Studies":
              return "Global Studies Hub " + (index+1);
            default:
              return major + " Academic Facility " + (index+1);
         }
      },
      "Research Centers": function(major, index) {
         switch(major) {
            case "Computer Science":
              return "AI Research Center " + (index+1);
            case "Engineering":
              return "Engineering Innovation Hub " + (index+1);
            case "Rotman Commerce":
              return "Business Research Center " + (index+1);
            case "Arts & Humanities":
              return "Cultural Research Institute " + (index+1);
            case "Social Sciences":
              return "Social Policy Research Center " + (index+1);
            case "Biological Sciences":
              return "Biomedical Research Center " + (index+1);
            case "Physical Sciences":
              return "Physical Sciences Lab " + (index+1);
            case "Health Sciences":
              return "Health Research Institute " + (index+1);
            case "Law":
              return "Legal Studies Research Center " + (index+1);
            case "Education":
              return "Educational Research Center " + (index+1);
            case "Architecture Design":
              return "Urban Design Research Lab " + (index+1);
            case "Music":
              return "Music Technology Research Center " + (index+1);
            case "Information":
              return "Data Science Research Hub " + (index+1);
            case "Kinesiology & Physical":
              return "Sports Science Research Center " + (index+1);
            case "International Studies":
              return "Global Affairs Research Institute " + (index+1);
            default:
              return major + " Research Center " + (index+1);
         }
      },
      "Student Clubs": function(major, index) {
         switch(major) {
            case "Computer Science":
              return "Coding Club " + (index+1);
            case "Engineering":
              return "Robotics Club " + (index+1);
            case "Rotman Commerce":
              return "Entrepreneurship Club " + (index+1);
            case "Arts & Humanities":
              return "Literature & Arts Club " + (index+1);
            case "Social Sciences":
              return "Debate & Discussion Club " + (index+1);
            case "Biological Sciences":
              return "Biology Enthusiasts Club " + (index+1);
            case "Physical Sciences":
              return "Chemistry Club " + (index+1);
            case "Health Sciences":
              return "Health and Wellness Club " + (index+1);
            case "Law":
              return "Law Society " + (index+1);
            case "Education":
              return "Teaching Fellows Club " + (index+1);
            case "Architecture Design":
              return "Design & Architecture Club " + (index+1);
            case "Music":
              return "Music Ensemble " + (index+1);
            case "Information":
              return "Tech Innovators Club " + (index+1);
            case "Kinesiology & Physical":
              return "Sports & Fitness Club " + (index+1);
            case "International Studies":
              return "Global Exchange Club " + (index+1);
            default:
              return major + " Student Club " + (index+1);
         }
      },
      "Career & Networking": function(major, index) {
         switch(major) {
            case "Computer Science":
              return "Tech Career Center " + (index+1);
            case "Engineering":
              return "Engineering Career Hub " + (index+1);
            case "Rotman Commerce":
              return "Business Networking Center " + (index+1);
            case "Arts & Humanities":
              return "Creative Industry Network " + (index+1);
            case "Social Sciences":
              return "Public Policy Networking " + (index+1);
            case "Biological Sciences":
              return "Life Sciences Career Center " + (index+1);
            case "Physical Sciences":
              return "Physical Sciences Career Hub " + (index+1);
            case "Health Sciences":
              return "Healthcare Career Center " + (index+1);
            case "Law":
              return "Legal Career Center " + (index+1);
            case "Education":
              return "Educational Career Hub " + (index+1);
            case "Architecture Design":
              return "Design & Architecture Career Center " + (index+1);
            case "Music":
              return "Music Industry Network " + (index+1);
            case "Information":
              return "Information Systems Career Center " + (index+1);
            case "Kinesiology & Physical":
              return "Sports Career & Networking " + (index+1);
            case "International Studies":
              return "Global Careers Hub " + (index+1);
            default:
              return major + " Career Center " + (index+1);
         }
      },
      "Social & Cultural": function(major, index) {
         switch(major) {
            case "Computer Science":
              return "Digital Culture Hub " + (index+1);
            case "Engineering":
              return "Engineering Social Club " + (index+1);
            case "Rotman Commerce":
              return "Business Culture Lounge " + (index+1);
            case "Arts & Humanities":
              return "Artistic Expression Center " + (index+1);
            case "Social Sciences":
              return "Community Engagement Hub " + (index+1);
            case "Biological Sciences":
              return "Science & Society Forum " + (index+1);
            case "Physical Sciences":
              return "Physical Arts & Culture " + (index+1);
            case "Health Sciences":
              return "Wellness & Culture Center " + (index+1);
            case "Law":
              return "Legal Culture Society " + (index+1);
            case "Education":
              return "Cultural Learning Center " + (index+1);
            case "Architecture Design":
              return "Architectural Culture Space " + (index+1);
            case "Music":
              return "Music and Arts Center " + (index+1);
            case "Information":
              return "Digital Media Culture Hub " + (index+1);
            case "Kinesiology & Physical":
              return "Sports Culture Center " + (index+1);
            case "International Studies":
              return "Global Cultural Exchange " + (index+1);
            default:
              return major + " Cultural Center " + (index+1);
         }
      },
      "Advising & Support": function(major, index) {
         switch(major) {
            case "Computer Science":
              return "CS Academic Advising " + (index+1);
            case "Engineering":
              return "Engineering Support Center " + (index+1);
            case "Rotman Commerce":
              return "Business Advising Office " + (index+1);
            case "Arts & Humanities":
              return "Arts & Humanities Advising " + (index+1);
            case "Social Sciences":
              return "Social Sciences Support " + (index+1);
            case "Biological Sciences":
              return "Biological Sciences Advising " + (index+1);
            case "Physical Sciences":
              return "Physical Sciences Support " + (index+1);
            case "Health Sciences":
              return "Health Advising Center " + (index+1);
            case "Law":
              return "Law Academic Support " + (index+1);
            case "Education":
              return "Educational Advising Center " + (index+1);
            case "Architecture Design":
              return "Design Advising Office " + (index+1);
            case "Music":
              return "Music Support Services " + (index+1);
            case "Information":
              return "Information Advising Center " + (index+1);
            case "Kinesiology & Physical":
              return "Kinesiology Support Office " + (index+1);
            case "International Studies":
              return "International Studies Advising " + (index+1);
            default:
              return major + " Advising " + (index+1);
         }
      },
    };

    // ---------- Enhance resources with realistic names (shortened description) ----------
    function enhanceResources(groupedResources, major) {
      for (let category in groupedResources) {
        groupedResources[category] = groupedResources[category].map((res, index) => {
           if (simulatedResourceNames[category]) {
             res.name = simulatedResourceNames[category](major, index);
             // Shortened description text
             res.description = `${res.name} for ${major} students.`;
           }
           return res;
        });
      }
      return groupedResources;
    }

    // ---------- Different resources ----------
    function generateResourcesForMajor(major) {
      const categories = ["Academic Facilities", "Research Centers", "Student Clubs", "Career & Networking", "Social & Cultural", "Advising & Support"];
      let resources = [];
      for (let i = 0; i < 10; i++) {
        const cat = categories[i % categories.length];
        resources.push({
          name: `${major} Resource #${i + 1}`,
          category: cat,
          lat: 43.6629 + (Math.random() - 0.5) / 200,
          lng: -79.3957 + (Math.random() - 0.5) / 200,
          description: `A simulated resource in ${cat} for ${major}.`,
          hours: 'Mon-Fri: 8AM-10PM',
          contact: `${major.toLowerCase().replace(/\s/g, '')}@utoronto.ca | (416) 555-00${i}`,
          occupancy: Math.floor(30 + Math.random() * 70),
          lastUpdated: `${Math.floor(Math.random() * 10) + 1} mins ago`,
          facilities: {
            computers: `${Math.floor(20 + Math.random() * 10)}/${Math.floor(30 + Math.random() * 10)}`,
            printers: `${Math.floor(1 + Math.random() * 2)}/${Math.floor(2 + Math.random() * 2)}`,
            groupRooms: `${Math.floor(4 + Math.random() * 4)}/${Math.floor(8 + Math.random() * 4)}`,
            quietZones: Math.floor(1 + Math.random() * 2),
          },
          studySpaces: {
            individualDesks: Math.floor(50 + Math.random() * 50),
            groupRooms: Math.floor(4 + Math.random() * 4),
            readingLounges: Math.floor(2 + Math.random() * 3),
          },
        });
      }
      const grouped = {};
      resources.forEach(res => {
        if (!grouped[res.category]) grouped[res.category] = [];
        grouped[res.category].push(res);
      });
      return grouped;
    }

    // ---------- Click card and get into map page ----------
    function goToMap(major) {
      currentMajor = major;
      navigateToPage('map');
      setTimeout(() => {
        initMap();
        loadMajorResources(major);
      }, 100);
    }

    // ---------- Campus Boundary changed to -79.390 ----------
    function initMap() {
      if (map) {
        map.remove();
        map = null;
      }
      map = L.map('map').setView([43.6629, -79.3957], 15);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

      // Boundary：-79.390
      L.polygon(
        [
          [43.671, -79.403],
          [43.671, -79.390],
          [43.656, -79.390],
          [43.656, -79.403],
        ],
        { color: '#002A5C', fillColor: '#002A5C', fillOpacity: 0.1 }
      ).addTo(map);

      // Legend：Resource Location
      const legend = L.control({ position: 'bottomleft' });
      legend.onAdd = function () {
        const div = L.DomUtil.create('div', 'p-4 bg-white rounded shadow');
        div.innerHTML = `
          <h4 class="font-bold mb-2">Legend</h4>
          <div class="flex items-center mb-2">
            <div class="w-4 h-4 bg-blue-500 rounded-full mr-2"></div>
            <span>Resource Location</span>
          </div>
          <div class="flex items-center">
            <div class="w-4 h-4 border-2 border-blue-700 bg-blue-200 mr-2"></div>
            <span>Campus Boundary</span>
          </div>
        `;
        return div;
      };
      legend.addTo(map);
    }

    // ---------- Load resources ----------
    function loadMajorResources(major) {
      let groupedResources = generateResourcesForMajor(major);
      groupedResources = enhanceResources(groupedResources, major);
      const categoryList = document.getElementById('categoryList');
      categoryList.innerHTML = '';
      for (const [category, resources] of Object.entries(groupedResources)) {
        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'resource-category';
        const title = document.createElement('h3');
        title.className = 'text-lg font-semibold text-gray-900 mb-4';
        title.textContent = category;
        categoryDiv.appendChild(title);
        const listDiv = document.createElement('div');
        listDiv.className = 'space-y-3';
        resources.forEach(res => {
          const marker = L.marker([res.lat, res.lng], { title: res.name }).addTo(map);
          marker.on('click', () => { openResourceModal(res); });
          const itemDiv = document.createElement('div');
          itemDiv.className = 'resource-item p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition-colors';
          itemDiv.innerHTML = `
            <div class="flex items-start">
              <div class="w-10 h-10 flex items-center justify-center bg-primary/10 rounded-lg">
                <i class="ri-file-list-2-line text-primary"></i>
              </div>
              <div class="ml-4">
                <h4 class="font-medium text-gray-900">${res.name}</h4>
                <p class="text-sm text-gray-600 mt-1">${res.description}</p>
              </div>
            </div>
          `;
          itemDiv.addEventListener('click', () => {
            openResourceModal(res);
            map.setView([res.lat, res.lng], 17);
          });
          listDiv.appendChild(itemDiv);
        });
        categoryDiv.appendChild(listDiv);
        categoryList.appendChild(categoryDiv);
      }
    }

    // ---------- Info pop-up (Resource Modal) ----------
    function openResourceModal(resource) {
      modalContent.innerHTML = `
        <h2 class="text-xl font-bold text-gray-900">${resource.name}</h2>
        <p class="text-sm text-gray-600">${resource.description}</p>
        <div class="mt-2 text-sm text-gray-600">
          <b>Hours:</b> ${resource.hours}<br/>
          <b>Contact:</b> ${resource.contact}
        </div>
        <div class="mt-4">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium">Current Occupancy: ${resource.occupancy}%</span>
            <span class="text-xs text-gray-500">Updated ${resource.lastUpdated}</span>
          </div>
          <div class="w-full h-2 bg-gray-200 rounded-full">
            <div class="h-2 bg-primary rounded-full" style="width: ${resource.occupancy}%"></div>
          </div>
        </div>
        <div class="mt-4 grid grid-cols-2 gap-2 text-sm">
          <div>
            <p class="font-medium">Available Facilities:</p>
            <ul class="mt-1 space-y-1">
              <li>Computers: ${resource.facilities.computers}</li>
              <li>Printers: ${resource.facilities.printers}</li>
              <li>Group Rooms: ${resource.facilities.groupRooms}</li>
              <li>Quiet Zones: ${resource.facilities.quietZones}</li>
            </ul>
          </div>
          <div>
            <p class="font-medium">Study Spaces:</p>
            <ul class="mt-1 space-y-1">
              <li>Individual Desks: ${resource.studySpaces.individualDesks}</li>
              <li>Group Rooms: ${resource.studySpaces.groupRooms}</li>
              <li>Reading Lounges: ${resource.studySpaces.readingLounges}</li>
            </ul>
          </div>
        </div>
        <div class="mt-4">
          <!-- Provider Details button now in blue (primary) -->
          <button onclick="openProviderModal(${JSON.stringify(resource).replace(/"/g, '&quot;')})" class="w-full px-4 py-2 bg-primary text-white rounded-button hover:bg-primary/90">
            Provider Details
          </button>
        </div>
        <div class="mt-6 flex space-x-4">
          <button onclick="reserveResource(${JSON.stringify(resource).replace(/"/g, '&quot;')})" class="flex-1 px-4 py-2 bg-primary text-white rounded-button hover:bg-primary/90">
            Reservation
          </button>
          <button onclick="closeResourceModal()" class="flex-1 px-4 py-2 border border-gray-200 rounded-button hover:bg-gray-50">
            Cancel
          </button>
        </div>
      `;
      resourceModal.classList.remove('hidden');
    }
    function closeResourceModal() {
      resourceModal.classList.add('hidden');
    }

    // ---------- Provider Details Modal Functions ----------
    const providerDetails = {
      "Academic Facilities": {
          title: "Academic Facilities Provider Details",
          introduction: "This facility offers state-of-the-art laboratories, study spaces, and equipment. It supports the academic needs of students in ",
          contact: "facilities@utoronto.ca",
          upcomingEvents: "Open lab sessions every Tuesday and Thursday.",
      },
      "Research Centers": {
          title: "Research Center Provider Details",
          introduction: "The research center is a hub for innovative projects and interdisciplinary research. It provides funding, mentorship, and resources for ",
          contact: "research@utoronto.ca",
          upcomingEvents: "Research symposium coming up next month.",
      },
      "Student Clubs": {
          title: "Student Club Provider Details",
          introduction: "This student club fosters community and peer learning through social events, workshops, and networking opportunities for ",
          contact: "clubs@utoronto.ca",
          upcomingEvents: "Weekly meet-ups every Friday with special guest speakers.",
      },
      "Career & Networking": {
          title: "Career & Networking Hub Provider Details",
          introduction: "This hub connects students with industry professionals and organizes career fairs and workshops. It is dedicated to serving ",
          contact: "career@utoronto.ca",
          upcomingEvents: "Upcoming career fair and networking events scheduled for next month.",
      },
      "Social & Cultural": {
          title: "Social & Cultural Center Provider Details",
          introduction: "This center promotes cultural diversity and social engagement with events that celebrate arts, music, and multiculturalism for ",
          contact: "social@utoronto.ca",
          upcomingEvents: "Annual cultural festival scheduled for the upcoming semester.",
      },
      "Advising & Support": {
          title: "Advising & Support Center Provider Details",
          introduction: "This center offers academic advising, mental health support, and peer mentoring services tailored for students in ",
          contact: "support@utoronto.ca",
          upcomingEvents: "Open advising sessions available throughout the week.",
      },
    };

    function openProviderModal(resource) {
      const providerModalContent = document.getElementById('providerModalContent');
      let details = providerDetails[resource.category];
      if (!details) {
        details = { title: "Provider Details", introduction: "Detailed information not available.", contact: "N/A", upcomingEvents: "N/A" };
      }
      providerModalContent.innerHTML = `
        <h2 class="text-xl font-bold text-gray-900">${details.title}</h2>
        <p class="text-sm text-gray-600">${details.introduction}${currentMajor}.</p>
        <div class="mt-2 text-sm text-gray-600">
          <b>Contact:</b> ${details.contact}<br/>
          <b>Upcoming Events:</b> ${details.upcomingEvents}
        </div>
        <div class="mt-6 flex justify-end">
          <button onclick="closeProviderModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-button hover:bg-gray-300">
            Close
          </button>
        </div>
      `;
      providerModal.classList.remove('hidden');
    }
    function closeProviderModal() {
      providerModal.classList.add('hidden');
    }

    // ---------- Reservation functions ----------
    function reserveResource(resource) {
      // Save reservation into myReservations
      myReservations.push({
        name: resource.name,
        description: resource.description,
        date: new Date().toLocaleDateString(),
        time: '09:00-11:00',
        major: currentMajor,
        contact: resource.contact,
      });
      alert(`You have reserved: ${resource.name}`);
      closeResourceModal();
    }

    // ---------- My Reservations page ----------
    function updateReservationList() {
      const list = document.getElementById('reservationList');
      list.innerHTML = '';
      if (myReservations.length === 0) {
        list.innerHTML = `
          <div class="text-center py-12">
            <i class="ri-calendar-line text-5xl text-gray-400"></i>
            <p class="mt-4 text-lg text-gray-600">No upcoming appointments</p>
            <p class="mt-2 text-sm text-gray-500">Browse resources and make a new reservation!</p>
          </div>
        `;
      } else {
        myReservations.forEach((res, index) => {
          const div = document.createElement('div');
          div.className = 'flex items-start p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors';
          div.innerHTML = `
            <div class="w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center">
              <i class="ri-calendar-2-line text-2xl text-primary"></i>
            </div>
            <div class="ml-4 flex-1">
              <div class="flex justify-between">
                <div>
                  <h3 class="font-medium text-gray-900">${res.name}</h3>
                  <p class="text-sm text-gray-600 mt-1">${res.description}</p>
                </div>
                <!-- Reserved pill -->
                <span class="inline-block px-3 py-3 text-sm font-semibold text-green-700 bg-green-100 border border-green-250 rounded-full">
                  Reserved
                </span>
              </div>
              <div class="mt-3 flex items-center space-x-4 text-sm text-gray-600">
                <span><i class="ri-calendar-line mr-1"></i>${res.date}</span>
                <span><i class="ri-time-line mr-1"></i>${res.time}</span>
                <span><i class="ri-bookmark-line mr-1"></i>${res.major}</span>
              </div>
              <div class="mt-4 flex space-x-4">
                <button onclick="contactReservation(${index})" class="text-sm text-primary hover:text-primary/90">
                  Contact
                </button>
                <button onclick="cancelReservation(${index})" class="text-sm text-red-600 hover:text-red-700">
                  Cancel
                </button>
              </div>
            </div>
          `;
          list.appendChild(div);
        });
      }
      document.getElementById('statUpcoming').textContent = myReservations.length;
    }

    // ---------- New: Update Campus Life Submissions in "My Reservations" page ----------
    function updateCampusLifeSubmissionList() {
      const container = document.getElementById('campusLifeSubmissionList');
      container.innerHTML = '';
      if (myCampusLifeApplications.length === 0) {
        container.innerHTML = `
          <div class="text-center py-6">
            <p class="text-sm text-gray-500">No campus life applications yet.</p>
          </div>
        `;
      } else {
        myCampusLifeApplications.forEach((app, idx) => {
          const div = document.createElement('div');
          div.className = 'flex items-start p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors';
          div.innerHTML = `
            <div class="w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center">
              <i class="ri-star-line text-2xl text-primary"></i>
            </div>
            <div class="ml-4 flex-1">
              <div class="flex justify-between">
                <div>
                  <h3 class="font-medium text-gray-900">${app.title}</h3>
                  <p class="text-sm text-gray-600 mt-1">${app.description}</p>
                </div>
                <!-- Reserved pill added here -->
                <span class="inline-block px-3 py-3 text-sm font-semibold text-green-700 bg-green-100 border border-green-250 rounded-full">
                  Reserved
                </span>
              </div>
              <div class="mt-3 flex items-center space-x-4 text-sm text-gray-600">
                <span><i class="ri-calendar-line mr-1"></i>${app.dateApplied}</span>
              </div>
              <div class="mt-4 flex space-x-4">
                <button onclick="contactCampusLifeApplication(${idx})" class="text-sm text-primary hover:text-primary/90">
                  Contact
                </button>
                <button onclick="cancelCampusLifeApplication(${idx})" class="text-sm text-red-600 hover:text-red-700">
                  Cancel
                </button>
              </div>
            </div>
          `;
          container.appendChild(div);
        });
      }
    }

    function contactCampusLifeApplication(index) {
      const app = myCampusLifeApplications[index];
      alert(`Contact for "${app.title}": campuslife@utoronto.ca`);
    }
    function cancelCampusLifeApplication(index) {
      if (confirm('Are you sure to cancel this application?')) {
        myCampusLifeApplications.splice(index, 1);
        updateCampusLifeSubmissionList();
      }
    }

    // ---------- Contact -> Pop-up ----------
    function contactReservation(index) {
      const res = myReservations[index];
      modalContent.innerHTML = `
        <h2 class="text-xl font-bold text-gray-900">Contact Information</h2>
        <p class="mt-2 text-sm text-gray-600">You can reach out via:</p>
        <p class="text-sm text-gray-800 font-medium mt-2">${res.contact || "No contact info"}</p>
        <div class="mt-6 flex justify-end">
          <button onclick="closeResourceModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-button hover:bg-gray-300">Cancel</button>
        </div>
      `;
      resourceModal.classList.remove('hidden');
    }

    function cancelReservation(index) {
      if (confirm('Are you sure to cancel this reservation?')) {
        myReservations.splice(index, 1);
        updateReservationList();
      }
    }
    function showCalendarView() {
      alert('Calendar view (demo).');
    }
    function makeNewReservation() {
      alert('New reservation form (demo).');
    }

    // ---------- Recommended-info + Some AI generated images (demo) ----------
    const recommendedForInfo = [
      {
        name: 'Information Systems Lab',
        desc: 'Advanced computing facility with specialized software',
        availability: 'Available Now',
        image: 'https://public.readdy.ai/ai/img_res/ab38ec5f36e65f0582f3d59d4d5e3e7d.jpg',
      },
      {
        name: 'Data Science Workshop',
        desc: 'Collaborative space for data analysis projects',
        availability: '2 Spots Left',
        image: 'https://public.readdy.ai/ai/img_res/81bcda603f2b8e19cfcac1026461c336.jpg',
      },
      {
        name: 'UX Research Lab',
        desc: 'User testing and design research facility',
        availability: 'Available Tomorrow',
        image: 'https://public.readdy.ai/ai/img_res/8ebaba63bcff5ccfad57040f6c24a5f1.jpg',
      },
    ];
    function loadRecommendedResources() {
      const container = document.getElementById('recommendedResources');
      container.innerHTML = '';
      recommendedForInfo.forEach((res) => {
        const div = document.createElement('div');
        div.className = 'flex items-start p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors cursor-pointer';
        div.innerHTML = `
          <img src="${res.image}" alt="${res.name}" class="w-16 h-16 rounded-lg object-cover">
          <div class="ml-4">
            <h4 class="font-medium text-gray-900">${res.name}</h4>
            <p class="text-sm text-gray-600 mt-1">${res.desc}</p>
            <span class="inline-block mt-2 px-2 py-1 text-xs font-medium text-primary bg-primary/10 rounded-full">
              ${res.availability}
            </span>
          </div>
        `;
        container.appendChild(div);
      });
    }
    reservationsPage.addEventListener('click', loadRecommendedResources);
    document.querySelector('[onclick="navigateToPage(\'reservations\')"]').addEventListener('click', loadRecommendedResources);

    // ---------- Campus Life Page Functionality ----------

    // Sample simulated campus life items
    const campusLifeItems = [
      {
        title: "UofT Clubs Directory",
        category: "Clubs & Activities",
        description: "Browse all clubs on campus, their meeting spots, and activities.",
        location: "Student Centre, Room 101",
        calendar: "Every Monday at 5 PM",
        contact: "clubs@utoronto.ca"
      },
      {
        title: "Annual Club Fair",
        category: "Calendar of Events",
        description: "Join the club fair to meet representatives and learn about various groups.",
        location: "Main Campus Courtyard",
        calendar: "October 15, 2025, 10 AM - 4 PM",
        contact: "events@utoronto.ca"
      },
      {
        title: "Campus Navigation",
        category: "Campus Navigation",
        description: "Interactive campus map to help you find buildings, clubs, and services.",
        location: "Online Interactive Map",
        calendar: "N/A",
        contact: "info@utoronto.ca"
      },
      {
        title: "Meet & Greet Sessions",
        category: "How to Meet People",
        description: "Social sessions for students with similar interests.",
        location: "Student Lounge, Building A",
        calendar: "Fridays at 6 PM",
        contact: "social@utoronto.ca"
      },
      {
        title: "Accessibility & Support",
        category: "Accessibility & Support",
        description: "Information on accessible facilities and support services.",
        location: "Accessibility Office, Room 205",
        calendar: "Mon-Fri, 9 AM - 5 PM",
        contact: "access@utoronto.ca"
      },
      {
        title: "Cultural Events",
        category: "Culture",
        description: "Art exhibits, performances, and cultural festivals across campus.",
        location: "Various Locations",
        calendar: "See full calendar online",
        contact: "culture@utoronto.ca"
      },
      {
        title: "Health & Wellness Programs",
        category: "Health & Wellness",
        description: "Workshops, fitness classes, and mental health resources for students.",
        location: "Health Centre, Room 10",
        calendar: "Weekly sessions",
        contact: "health@utoronto.ca"
      },
      {
        title: "Internship & Work Opportunities",
        category: "Work Opportunities",
        description: "Discover internships, part-time jobs, and career networking events.",
        location: "Career Centre, Building C",
        calendar: "Monthly updates",
        contact: "career@utoronto.ca"
      }
    ];

    // New: Simulated events for each Campus Life category (at least 5 per category)
    const campusLifeEvents = {
      "Clubs & Activities": [
        { title: "Robotics Workshop", description: "Learn to build robots with peers.", location: "Engineering Building 2", eventTime: "Tuesday, 4 PM" },
        { title: "Art Club Meetup", description: "Discuss and create art together.", location: "Art Studio, Room 5", eventTime: "Wednesday, 3 PM" },
        { title: "Coding Bootcamp", description: "Intensive coding sessions for beginners.", location: "Computer Lab", eventTime: "Saturday, 10 AM" },
        { title: "Debate Tournament", description: "Friendly debate competition.", location: "Social Sciences Hall", eventTime: "Friday, 6 PM" },
        { title: "Photography Walk", description: "Capture campus life through your lens.", location: "Campus Grounds", eventTime: "Sunday, 2 PM" }
      ],
      "Calendar of Events": [
        { title: "Club Fair 2025", description: "Explore various student clubs.", location: "Main Campus Courtyard", eventTime: "October 15, 2025, 10 AM - 4 PM" },
        { title: "Tech Expo", description: "Showcase of latest technological innovations.", location: "Tech Hub", eventTime: "November 20, 2025" },
        { title: "Cultural Night", description: "Celebrate diverse cultures with music and food.", location: "Cultural Centre", eventTime: "December 5, 2025" },
        { title: "Career Summit", description: "Network with industry professionals.", location: "Conference Hall", eventTime: "January 15, 2026" },
        { title: "Health & Wellness Fair", description: "Discover health resources and tips.", location: "Health Sciences Building", eventTime: "September 10, 2025" }
      ],
      "Campus Navigation": [
        { title: "Campus Tour", description: "Guided tour of campus landmarks.", location: "Main Entrance", eventTime: "Every Monday, 10 AM" },
        { title: "New Building Tour", description: "Discover the latest campus facilities.", location: "New Wing", eventTime: "Friday, 3 PM" },
        { title: "Map Training Session", description: "Learn to navigate the interactive map.", location: "Tech Lab", eventTime: "Wednesday, 2 PM" },
        { title: "Accessibility Walk", description: "Explore the best accessible routes.", location: "Various", eventTime: "Saturday, 11 AM" },
        { title: "Night Navigation Tour", description: "Experience campus at night.", location: "Campus Grounds", eventTime: "Friday, 8 PM" }
      ],
      "How to Meet People": [
        { title: "Speed Friending", description: "Quick rounds of introductions.", location: "Student Lounge", eventTime: "1st Friday, 7 PM" },
        { title: "Interest Meetup", description: "Meet peers who share your hobbies.", location: "Club Rooms", eventTime: "Thursday, 6 PM" },
        { title: "Networking Mixer", description: "Casual networking event.", location: "Campus Bar", eventTime: "Saturday, 9 PM" },
        { title: "Group Study Session", description: "Collaborative study to build connections.", location: "Library Study Rooms", eventTime: "Weekly" },
        { title: "Community Service Day", description: "Volunteer and meet like-minded people.", location: "Local Community Center", eventTime: "Annually" }
      ],
      "Accessibility & Support": [
        { title: "Accessibility Workshop", description: "Learn about campus accessibility.", location: "Support Centre", eventTime: "October 10, 2025" },
        { title: "Mental Health Seminar", description: "Stress management and counseling info.", location: "Health Centre", eventTime: "November 5, 2025" },
        { title: "Tutoring Session", description: "Extra academic tutoring available.", location: "Advising Office", eventTime: "Mon-Fri, 9 AM - 5 PM" },
        { title: "Feedback Forum", description: "Share your accessibility experience.", location: "Student Centre", eventTime: "2nd Thursday, 4 PM" },
        { title: "Peer Support Group", description: "Group discussions on shared challenges.", location: "Community Room", eventTime: "Weekly" }
      ],
      "Culture": [
        { title: "International Food Festival", description: "Taste dishes from around the world.", location: "Main Campus Courtyard", eventTime: "September 25, 2025" },
        { title: "Art Exhibition", description: "Display of student art and photography.", location: "Gallery", eventTime: "October 1-31, 2025" },
        { title: "Live Concert", description: "Campus band performance.", location: "Student Centre Auditorium", eventTime: "December 5, 2025" },
        { title: "Dance Workshop", description: "Learn traditional dances.", location: "Dance Studio", eventTime: "Every Saturday" },
        { title: "Theatre Performance", description: "Drama club presents a play.", location: "Campus Theatre", eventTime: "November 20, 2025" }
      ],
      "Health & Wellness": [
        { title: "Yoga Class", description: "Relax with weekly yoga sessions.", location: "Health Centre", eventTime: "Mondays, 7 AM" },
        { title: "Meditation Session", description: "Guided meditation for stress relief.", location: "Quiet Zone", eventTime: "Daily, 8 AM" },
        { title: "Nutrition Seminar", description: "Learn healthy eating habits.", location: "Lecture Hall", eventTime: "October 20, 2025" },
        { title: "Fitness Bootcamp", description: "Intense group workout.", location: "Campus Gym", eventTime: "Tuesdays, 6 PM" },
        { title: "Mental Health Workshop", description: "Coping strategies and support.", location: "Counseling Room", eventTime: "Fridays, 3 PM" }
      ],
      "Work Opportunities": [
        { title: "Software Engineering Internship", description: "6-month internship opportunity.", location: "Tech Company HQ", eventTime: "Apply by December 1, 2025" },
        { title: "Business Analyst Position", description: "Entry-level job opportunity.", location: "Rotman Commerce Office", eventTime: "Apply by November 15, 2025" },
        { title: "Design Intern", description: "Internship in creative design.", location: "Design Studio", eventTime: "Apply by October 30, 2025" },
        { title: "Marketing Coordinator", description: "Part-time job opportunity.", location: "Campus Marketing Office", eventTime: "Apply by January 10, 2026" },
        { title: "Club Fair Volunteer", description: "Volunteer to support the annual club fair.", location: "Student Centre", eventTime: "Event on October 15, 2025" }
      ]
    };

    function loadCampusLifeItems() {
      const listContainer = document.getElementById('campusLifeList');
      const searchInput = document.getElementById('campusLifeSearch');
      listContainer.innerHTML = '';

      // Filter items based on search query
      const query = searchInput.value.toLowerCase();
      const filteredItems = campusLifeItems.filter(item => 
        item.title.toLowerCase().includes(query) || 
        item.category.toLowerCase().includes(query) ||
        item.description.toLowerCase().includes(query)
      );

      // Create a card for each item
      filteredItems.forEach((item) => {
        const card = document.createElement('div');
        card.className = "p-6 bg-gray-50 rounded-xl shadow hover:bg-gray-100 cursor-pointer transition-colors";
        card.innerHTML = `
          <h3 class="text-xl font-bold text-gray-900 mb-2">${item.title}</h3>
          <p class="text-sm text-gray-600 mb-2">${item.description}</p>
          <p class="text-xs text-gray-500">Category: ${item.category}</p>
        `;
        card.addEventListener('click', () => {
          openCampusLifeModal(item);
        });
        listContainer.appendChild(card);
      });
    }

    function openCampusLifeModal(item) {
      campusLifeModalContent.innerHTML = `
        <h2 class="text-xl font-bold text-gray-900">${item.title}</h2>
        <p class="text-sm text-gray-600"><strong>Category:</strong> ${item.category}</p>
        <p class="text-sm text-gray-600"><strong>Description:</strong> ${item.description}</p>
        <p class="text-sm text-gray-600"><strong>Location:</strong> ${item.location}</p>
        <p class="text-sm text-gray-600"><strong>Calendar:</strong> ${item.calendar}</p>
        <p class="text-sm text-gray-600"><strong>Contact:</strong> ${item.contact}</p>
      `;
      campusLifeModal.classList.remove('hidden');
    }
    function closeCampusLifeModal() {
      campusLifeModal.classList.add('hidden');
    }

    function openCampusLifeEventsModal(category) {
      campusLifeEventsModalContent.innerHTML = ''; // clear
      const events = campusLifeEvents[category] || [];
      // Title row
      const heading = document.createElement('h2');
      heading.className = "text-xl font-bold text-gray-900 mb-4 col-span-3";
      heading.textContent = `${category} Events`;
      campusLifeEventsModalContent.appendChild(heading);

      events.forEach(eventItem => {
        const div = document.createElement('div');
        div.className = "p-4 bg-gray-50 rounded-xl shadow mb-4 flex flex-col";
        div.innerHTML = `
          <h3 class="font-bold text-gray-900">${eventItem.title}</h3>
          <p class="text-sm text-gray-600 mt-1 flex-grow">${eventItem.description}</p>
          <p class="text-xs text-gray-500 mt-2"><strong>Location:</strong> ${eventItem.location}</p>
          <p class="text-xs text-gray-500"><strong>When:</strong> ${eventItem.eventTime}</p>
          <!-- Changed button to use primary color -->
          <button class="mt-3 px-4 py-2 bg-primary text-white rounded-button hover:bg-primary/90 w-full"
            onclick='openCampusLifeEventDetailModal(${JSON.stringify(eventItem).replace(/"/g, "&quot;")})'>
            View Details
          </button>
        `;
        campusLifeEventsModalContent.appendChild(div);
      });

      // "Back" button in full row
      const backDiv = document.createElement('div');
      backDiv.className = "col-span-3 flex justify-end mt-4";
      backDiv.innerHTML = `
        <button onclick="closeCampusLifeEventsModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-button hover:bg-gray-300">
          Back
        </button>
      `;
      campusLifeEventsModalContent.appendChild(backDiv);

      campusLifeEventsModal.classList.remove('hidden');
    }
    function closeCampusLifeEventsModal() {
      campusLifeEventsModal.classList.add('hidden');
    }

    function openCampusLifeEventDetailModal(eventItem) {
      let html = `<h2 class="text-xl font-bold text-gray-900 mb-4">${eventItem.title}</h2>`;
      html += `<p class="text-sm text-gray-600"><strong>Description:</strong> ${eventItem.description}</p>`;
      html += `<p class="text-sm text-gray-600"><strong>Location:</strong> ${eventItem.location}</p>`;
      html += `<p class="text-sm text-gray-600"><strong>When:</strong> ${eventItem.eventTime}</p>`;
      html += `<div class="mt-6 flex space-x-4">
                 <button onclick="submitCampusLifeApplication('${eventItem.title}','${eventItem.description}')" class="flex-1 px-4 py-2 bg-primary text-white rounded-button hover:bg-primary/90">
                   Submit Application
                 </button>
                 <button onclick="closeCampusLifeEventDetailModal()" class="flex-1 px-4 py-2 border border-gray-200 rounded-button hover:bg-gray-50">
                   Cancel
                 </button>
               </div>`;
      campusLifeEventDetailModalContent.innerHTML = html;
      campusLifeEventDetailModal.classList.remove('hidden');
    }
    function closeCampusLifeEventDetailModal() {
      campusLifeEventDetailModal.classList.add('hidden');
    }

    // ---------- Insert the event into myCampusLifeApplications and show in "My Reservations" page ----------
    function submitCampusLifeApplication(title, description) {
      alert(`Application submitted for "${title}"`);
      // Add to the array, also include a default contact value
      myCampusLifeApplications.push({
        title: title,
        description: description,
        dateApplied: new Date().toLocaleDateString(),
        contact: "campuslife@utoronto.ca"
      });
      closeCampusLifeEventDetailModal();
    }

    // ---------- MutationObserver to remove the "Close" button in the Campus Life Modal ----------
    const removeCloseButtonObserver = new MutationObserver(mutations => {
      mutations.forEach(mutation => {
        mutation.addedNodes.forEach(node => {
          if (node.nodeType === Node.ELEMENT_NODE && node.id === "campusLifeModalContent") {
            const closeBtn = campusLifeModal.querySelector('button[onclick="closeCampusLifeModal()"]');
            if (closeBtn) {
              closeBtn.remove();
            }
          }
        });
      });
    });
    if (campusLifeModal) {
      removeCloseButtonObserver.observe(campusLifeModal, { childList: true, subtree: true });
    }

    // ---------- MutationObserver to append "View Events List" button in Campus Life Modal ----------
    const campusLifeModalObserver = new MutationObserver(mutations => {
      mutations.forEach(mutation => {
        mutation.addedNodes.forEach(node => {
          if (node.nodeType === Node.ELEMENT_NODE && campusLifeModalContent && !campusLifeModalContent.querySelector('.view-events-btn')) {
            const btn = document.createElement('button');
            btn.className = "view-events-btn mt-4 px-4 py-2 bg-primary text-white rounded-button hover:bg-primary/90 w-full";
            btn.innerText = "View Events List";
            btn.addEventListener('click', () => {
              const catPara = campusLifeModalContent.querySelector('p.text-sm');
              if (catPara && catPara.innerText.includes("Category:")) {
                const category = catPara.innerText.split("Category:")[1].trim();
                openCampusLifeEventsModal(category);
              } else {
                alert("Category information not found!");
              }
            });
            campusLifeModalContent.appendChild(btn);
          }
        });
      });
    });
    if(campusLifeModalContent){
      campusLifeModalObserver.observe(campusLifeModalContent, { childList: true });
    }

    // ---------- MutationObserver to shorten map resource descriptions ----------
    const categoryList = document.getElementById('categoryList');
    const observer = new MutationObserver(mutations => {
      mutations.forEach(mutation => {
        mutation.addedNodes.forEach(node => {
          if (node.nodeType === Node.ELEMENT_NODE) {
            const paragraphs = node.querySelectorAll('p.text-sm');
            paragraphs.forEach(p => {
              if (p.innerText.length > 40) {
                p.innerText = p.innerText.slice(0, 40) + '...';
              }
            });
          }
        });
      });
    });
    if (categoryList) {
      observer.observe(categoryList, { childList: true, subtree: true });
    }
  </script>

  <!-- ===================== Login and Check ===================== -->
  <script>
    // Function
    function requireLoginWrapper(originalFunction) {
      return function(...args) {
        if (!isLoggedIn) {
          alert("Please log in to use this feature.");
          showSignInModal();
          return;
        }
        return originalFunction.apply(this, args);
      };
    }

    // Cover all functions
    navigateToPage = requireLoginWrapper(navigateToPage);
    returnToHome = requireLoginWrapper(returnToHome);
    goToCampusLife = requireLoginWrapper(goToCampusLife);
    goToMap = requireLoginWrapper(goToMap);
    reserveResource = requireLoginWrapper(reserveResource);
    openResourceModal = requireLoginWrapper(openResourceModal);
    openProviderModal = requireLoginWrapper(openProviderModal);
    makeNewReservation = requireLoginWrapper(makeNewReservation);
    showCalendarView = requireLoginWrapper(showCalendarView);
    openCampusLifeModal = requireLoginWrapper(openCampusLifeModal);
    openCampusLifeEventsModal = requireLoginWrapper(openCampusLifeEventsModal);
    openCampusLifeEventDetailModal = requireLoginWrapper(openCampusLifeEventDetailModal);
    submitCampusLifeApplication = requireLoginWrapper(submitCampusLifeApplication);
    contactReservation = requireLoginWrapper(contactReservation);
    cancelReservation = requireLoginWrapper(cancelReservation);
    contactCampusLifeApplication = requireLoginWrapper(contactCampusLifeApplication);
    cancelCampusLifeApplication = requireLoginWrapper(cancelCampusLifeApplication);
  </script>

<!-- ===================== Search ===================== -->
<script>
  // Search Bar
  const campusLifeSearchInput = document.getElementById('campusLifeSearch');
  if (campusLifeSearchInput) {
    campusLifeSearchInput.addEventListener('input', function() {
      loadCampusLifeItems();
    });
  }

  // Right Search Bar
  const resourceSearchInput = document.querySelector('input[placeholder="Search resources..."]');
  if (resourceSearchInput) {
    resourceSearchInput.addEventListener('input', function() {
      const query = this.value.toLowerCase();
      // Check all resources
      const resourceItems = document.querySelectorAll('#categoryList .resource-item');
      resourceItems.forEach(item => {
        const text = item.textContent.toLowerCase();
        if (text.includes(query)) {
          item.style.display = '';
        } else {
          item.style.display = 'none';
        }
      });
      // Hinde block
      const categoryContainers = document.querySelectorAll('#categoryList .resource-category');
      categoryContainers.forEach(container => {
        // Check container
        const visibleItems = container.querySelectorAll('.resource-item:not([style*="display: none"])');
        container.style.display = visibleItems.length > 0 ? '' : 'none';
      });
    });
  }
</script>
</body>
</html>
